# ISLOB Bot

Телеграм-бот для відстеження фітнесу та коучингу, який допомагає користувачам моніторити свої тренування, сон, рівень стресу та загальне самопочуття.

## Огляд

ISLOB Bot - це комплексне рішення для відстеження фітнесу, яке взаємодіє з користувачами через Telegram. Бот збирає дані про тренування користувачів, режим сну, рівень стресу та загальне самопочуття через регулярні перевірки та опитування. Він надає персоналізовану статистику, візуалізації та аналітику, щоб допомогти користувачам оптимізувати свій фітнес-шлях.

## Функції

- **Ранкові опитування**: Щоденні перевірки для відстеження якості сну, ваги та загального самопочуття
- **Відстеження тренувань**: Запис тренувань з деталями про тривалість, інтенсивність та дискомфорт
- **Зворотній зв'язок після тренування**: Збір даних про стрес та крепатуру після тренувань
- **Автоматичні сповіщення**: Налаштовувані нагадування для ранкових перевірок та тренувань
- **Візуалізація статистики**: Візуальне представлення режиму сну, рівня стресу та інтенсивності тренувань
- **Аналітика на базі ШІ**: Використання моделей OpenAI GPT для аналізу фітнес-даних та надання персоналізованих рекомендацій

## Технічний стек

- **Бекенд**: Python з SQLAlchemy ORM
- **База даних**: PostgreSQL
- **Фреймворк для бота**: python-telegram-bot
- **Візуалізація даних**: Matplotlib, Seaborn, Pandas
- **Інтеграція ШІ**: OpenAI API (моделі GPT)
- **Планування**: APScheduler
- **Міграції бази даних**: Alembic

## Встановлення

### Передумови

- Python 3.8+
- PostgreSQL
- Токен Telegram Bot (від BotFather)
- Ключ API OpenAI

### Налаштування

1. Клонуйте репозиторій:
   ```
   git clone https://github.com/YukihiroSM/islobbot.git
   cd islobbot
   ```

2. Створіть віртуальне середовище та встановіть залежності:
   ```
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   pip install -r requirements.txt
   ```

3. Створіть файл `.env` в кореневій директорії проекту з наступними змінними:
   ```
   TOKEN=your_telegram_bot_token
   DATABASE_URL=postgresql://username:password@localhost/islobbot
   ADMIN_CHAT_IDS=["your_telegram_chat_id"]
   OPENAI_API_KEY=your_openai_api_key
   OPENAI_ASSISTANT_ID=your_openai_assistant_id
   ```

4. Ініціалізуйте базу даних:
   ```
   python init_db.py
   ```

5. Запустіть бота:
   ```
   python main.py
   ```

## Схема бази даних

База даних складається з кількох основних таблиць:

- **Users**: Зберігає інформацію про користувачів та їхні налаштування
- **NotificationPreference**: Керує налаштуваннями сповіщень для кожного користувача
- **Training**: Записує тренування з деталями
- **MorningQuiz**: Зберігає дані щоденних ранкових опитувань

## Потоки розмов

Бот реалізує кілька потоків розмов:

### 1. Розмова знайомства
- **Мета**: Реєстрація нових користувачів та збір початкової інформації
- **Потік**:
  - Починається з команди `/start`
  - Збирає повне ім'я користувача
  - Запитує бажаний час ранкового сповіщення
  - Налаштовує параметри ранкового сповіщення
  - Направляє користувача до головного меню

### 2. Ранкове опитування
- **Мета**: Щоденна перевірка сну, ваги та самопочуття
- **Потік**:
  - Запускається за розкладом ранкового сповіщення
  - Запитує, як почувається користувач (шкала 1-10)
  - Збирає тривалість сну (години:хвилини)
  - Записує поточну вагу користувача
  - Запитує, чи планує користувач тренування сьогодні
  - Якщо так, збирає очікуваний час тренування
  - Створює сповіщення про тренування, якщо потрібно
  - Зберігає всі дані в базу даних

### 3. Розмова початку тренування
- **Мета**: Ініціює сеанс тренування
- **Потік**:
  - Запускається, коли користувач вибирає "Почати тренування"
  - Запитує про самопочуття перед тренуванням (шкала 1-10)
  - Записує час початку тренування
  - Надсилає PDF-документ з тренуванням (персоналізований або стандартний)
  - Оновлює статуси сповіщень
  - Надає кнопку "Закінчити тренування"

### 4. Розмова закінчення тренування
- **Мета**: Завершує сеанс тренування та збирає відгуки
- **Потік**:
  - Запускається, коли користувач вибирає "Закінчити тренування"
  - Запитує оцінку складності тренування (шкала 1-10)
  - Запитує, чи відчував користувач біль/дискомфорт
  - Якщо так, повідомляє адміністраторів про проблему
  - Записує тривалість тренування та час закінчення
  - Оновлює статуси сповіщень
  - Відображає мотиваційне повідомлення
  - Повертається до головного меню

### 5. Розмова після тренування
- **Мета**: Збір інформації про рівень стресу та крепатуру після тренування
- **Потік**:
  - Запускається за розкладом сповіщення наступного дня після тренування
  - Запитує рівень стресу (шкала 1-10)
  - Запитує, чи відчуває користувач м'язову крепатуру
  - Записує відповіді в базу даних
  - Повертається до головного меню

### 6. Розмова призначення PDF
- **Мета**: Дозволяє адміністраторам призначати PDF-документи з тренуваннями користувачам
- **Потік**:
  - Запускається, коли адміністратор вибирає "Тренувальний PDF"
  - Відображає список користувачів
  - Адміністратор вибирає користувача
  - Адміністратор завантажує PDF-документ
  - Система призначає PDF вибраному користувачу
  - Повідомляє користувача про новий документ з тренуванням
  - Повертається до головного меню

## Візуалізація статистики

Система статистики генерує візуалізації з наступними характеристиками:
- Дані про сон відображаються у вигляді стовпчастої діаграми
- Стрес, складність тренувань та самопочуття відображаються у вигляді лінійних графіків
- Усі графіки використовують формат день.місяць (ДД.ММ) для міток на осі x

### Збір та аналіз даних

Система статистики збирає та аналізує кілька типів даних користувача:
- **Тривалість сну**: Відстежується щодня через ранкові опитування
- **Самопочуття**: Самооцінка за шкалою від 1 до 10
- **Складність тренування**: Оцінка користувачем складності кожного тренування
- **Рівень стресу**: Вимірювання стресу після тренування
- **М'язова крепатура**: Відстежується після тренувань (позначається X на графіках складності)

### Компоненти візуалізації

Система генерує комплексну візуалізацію з чотирма основними компонентами, розташованими в сітці 2x2:
1. **Графік сну (внизу зліва)**: Стовпчаста діаграма, що показує тривалість сну в годинах для кожного дня
2. **Графік стресу (вгорі зліва)**: Лінійний графік, що показує рівень стресу з часом
3. **Графік складності тренування (вгорі справа)**: Лінійний графік зі спеціальними маркерами X для тренувань, які викликали м'язову крепатуру
4. **Графік самопочуття (внизу справа)**: Лінійний графік, що відстежує загальне самопочуття

Усі графіки використовують однаковий формат дати (ДД.ММ) на осі x для легкого читання, і система використовує чисту тему whitegrid з пастельними кольорами для покращення візуальної естетики.

### Періоди часу

Статистика може бути згенерована для різних періодів часу:
- **Тижнева**: Дані за останні 7 днів
- **Місячна**: Дані за останні 28 днів

### Аналітика на базі ШІ

Система статистики використовує OpenAI Assistant API для аналізу зібраних даних та надання персоналізованих висновків про:
- Патерни тренувань та їх ефективність
- Якість сну та її вплив на продуктивність
- Рівні стресу та патерни відновлення
- Загальний прогрес фітнесу та тенденції

Ці висновки, згенеровані ШІ, представлені поряд зі статистичними візуалізаціями, щоб надати користувачам комплексне розуміння їхнього фітнес-шляху.

### Технічна реалізація

Система візуалізації побудована з використанням:
- **Pandas**: Для маніпуляції та аналізу даних
- **Matplotlib**: Для створення фреймворку візуалізації та макету сітки
- **Seaborn**: Для покращеної візуальної естетики з пастельною кольоровою палітрою
- **OpenAI API**: Для аналізу фітнес-даних на базі ШІ

Система дотримується послідовного візуального стилю з чистою темою whitegrid та пастельними кольорами для покращення читабельності та користувацького досвіду. Реалізація спеціально використовує стовпчасті діаграми для візуалізації даних про сон, зберігаючи лінійні графіки для інших метрик, відповідно до дизайн-переваг проекту.

## Інтеграція ШІ

Система використовує існуючого OpenAI Assistant для аналізу фітнес-метрик. Ця інтеграція вимагає:

1. **Налаштування Assistant**: OpenAI Assistant повинен бути налаштований спеціально для аналізу фітнес-даних з наступними можливостями:
   - Розуміння патернів тренувань та їх впливу на самопочуття користувача
   - Аналіз якості сну та її кореляції з продуктивністю тренувань
   - Моніторинг рівнів стресу та пропонування стратегій відновлення
   - Відстеження загального прогресу та надання мотиваційного зворотного зв'язку

2. **Налаштування середовища**: ID Assistant повинен бути налаштований у файлі `.env`:
   ```
   OPENAI_ASSISTANT_ID=your_openai_assistant_id
   ```

3. **Огляд обробки даних**: Система збирає дані користувача з ранкових опитувань та тренувань, які потім використовуються для генерації персоналізованих висновків та рекомендацій.

### Переваги інтеграції ШІ

- **Персоналізовані висновки**: ШІ аналізує індивідуальні патерни, які можуть бути неочевидними лише з графіків
- **Цілісний аналіз**: Враховує взаємозв'язок між різними метриками (сон, стрес, інтенсивність тренувань)
- **Дієві рекомендації**: Надає конкретні пропозиції для покращення результатів тренувань
- **Мотиваційна підтримка**: Пропонує заохочення на основі прогресу та досягнень

## Розгортання

Проект включає конфігурацію Docker для легкого розгортання:

1. Збудуйте та запустіть з Docker Compose:
   ```
   docker-compose up -d
   ```

Це запустить бота та базу даних PostgreSQL у контейнерах.

## Розробка

### Міграції бази даних

Проект використовує Alembic для міграцій бази даних:

```
# Створення нової міграції
alembic revision --autogenerate -m "description"

# Застосування міграцій
alembic upgrade head
```

### Стиль коду

Проект дотримується стильових рекомендацій PEP 8. Ви можете форматувати свій код за допомогою Black:

```
black .
```
